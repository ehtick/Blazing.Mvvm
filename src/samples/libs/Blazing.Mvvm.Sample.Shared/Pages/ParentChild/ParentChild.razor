@page "/parentchild"
@inherits MvvmComponentBase<ParentChildViewModel>

<PageTitle>Parent-Child Messaging</PageTitle>

<BootstrapBreadcrumbs />

<h1>Parent-Child Communication</h1>

<p class="lead">@ViewModel!.Text</p>

<ParentChildInfo />

<div class="card mb-3">
    <div class="card-header">
        <h3 class="mb-0">Dynamic Child Components</h3>
    </div>
    <div class="card-body">
        <button type="button" class="btn btn-primary mb-3" @onclick="() => ViewModel.AddChildCommand.Execute(null)">
            <span class="bi bi-plus-circle"></span> Add Child Component
        </button>

        <div class="children-container">
            @foreach (string child in ViewModel.GetSortedKeys())
            {
                <DynamicComponent @key=@child Type="@typeof(ChildView)" Parameters="@ViewModel.Components[child].Parameters" />
            }
        </div>

        @if (!ViewModel.Components.Any())
        {
            <div class="alert alert-secondary" role="alert">
                <span class="bi bi-info-circle"></span> No child components yet. Click the button above to add one!
            </div>
        }
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h3 class="mb-0">How It Works</h3>
    </div>
    <div class="card-body">
        <ol class="mb-0">
            <li>The parent ViewModel creates child components dynamically using <code>DynamicComponent</code></li>
            <li>Each child has its own ViewModel instance (Transient lifetime)</li>
            <li>When a child is removed, it sends a message to the parent using <code>WeakReferenceMessenger</code></li>
            <li>The parent ViewModel receives the message via <code>RecipientViewModelBase&lt;TMessage&gt;</code></li>
            <li>The parent updates its component dictionary and notifies the UI to re-render</li>
        </ol>
    </div>
</div>
